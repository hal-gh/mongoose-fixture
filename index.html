<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <title>Mongoose-fixture by mgan59</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Mongoose-fixture</h1>
        <h2>Mongoose-Fixture is a data management and workflow tool that enables developers to easily organize and import data into mongodb from both a CLI and nodejs API.</h2>

        <section id="downloads">
          <a href="https://github.com/mgan59/mongoose-fixture/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/mgan59/mongoose-fixture/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/mgan59/mongoose-fixture" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a name="getting-started-with-mongoose-fixture" class="anchor" href="#getting-started-with-mongoose-fixture"><span class="octicon octicon-link"></span></a>Getting Started with Mongoose-Fixture</h1>

<h2>
<a name="what-is-mongoose-fixture" class="anchor" href="#what-is-mongoose-fixture"><span class="octicon octicon-link"></span></a>What is Mongoose-Fixture?</h2>

<p>Mongoose-Fixture is a data management and workflow tool that enables developers to easily organize and import data into mongodb from both a CLI and nodejs API.</p>

<h2>
<a name="why-should-i-use-mongoose-fixture-over-mongoimport" class="anchor" href="#why-should-i-use-mongoose-fixture-over-mongoimport"><span class="octicon octicon-link"></span></a>Why should I use Mongoose-Fixture over mongoimport</h2>

<p>Importing data with <code>mongoimport</code> is easy if you have a single json data file.  But if you have several json data files each with sub-document dependencies, validation, and simply organizing the data becomes difficult. Mongoose-Fixture is designed to solve these issues.</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>First you need to install the Mongoose-Fixture global so you have access to the <code>bin</code> CLI.  </p>

<pre><code>npm install -g mongoose-fixture
</code></pre>

<p>Next when you create a project you will want to install mongoose-fixture locally as well.</p>

<pre><code>cd your_project/
  npm init
npm install mongoose-fixture --save
</code></pre>

<p>If you are wondering why you are installing mongoose-fixture twice you may want to read - <a href="http://blog.nodejs.org/2011/03/23/npm-1-0-global-vs-local-installation/">npm Global vs Local installation</a></p>

<h2>
<a name="configuring-mongoose-fixture" class="anchor" href="#configuring-mongoose-fixture"><span class="octicon octicon-link"></span></a>Configuring Mongoose-Fixture</h2>

<p>I'll now walk you through configuring mongoose-fixture for an example project.  I've created a separate working repository with all the code samples.</p>

<h3>
<a name="generate-a-mongoose-fixture-config" class="anchor" href="#generate-a-mongoose-fixture-config"><span class="octicon octicon-link"></span></a>Generate a Mongoose-Fixture-Config</h3>

<p>First step in using Mongoose-Fixture one must create a mongoose-config file similarly to grunt.  This config file sets up file-paths, mongodb authentication, and most importantly the fixture/schema organization listings.</p>

<pre><code># from inside your project folder
mongoose-fixture --generateConfig

# you should see this output
Generating Fixture-Config -&gt; /your_project/mongoose-fixture-config.js
</code></pre>

<p>Now if you open your config file you will need to enter your mongodb server settings.  And you will see the default schema/fixture paths, you can change these if you want or keep the defaults.</p>

<pre><code>var fixtureConfig = FixtureConfig({
    mongoConnection:{
        'host':'localhost',
        'port':'27017',
        'dbname':''
    },
    paths:{
        schemaPath:__dirname+'/schemas/',
        dataFixturePath:__dirname+'/fixtures/'
    }
});
</code></pre>

<p>Regardless if you keep or change the file paths you will need to create those folders (<code>schemas</code> and <code>fixtures</code>) in your local directory.</p>

<p>The remaining section of the config file is where you define the <code>FixturePackages</code>.  The <code>FixturePackages</code> are how you organize json fixtures into packages so you can easily add/remove/reset groups of fixtures.  I'll delve further into packages later, but for now know that you define them here.  By default an 'all' package is provided so you can easily get started.</p>

<h3>
<a name="generate-a-fixtureschema" class="anchor" href="#generate-a-fixtureschema"><span class="octicon octicon-link"></span></a>Generate a Fixture/Schema</h3>

<p>If you haven't yet created your directories do so now</p>

<pre><code>mkdir fixtures/
mkdir schemas/
</code></pre>

<p>Now lets say we are doing an e-commerce app which needs products </p>

<pre><code># use our cli command to generate a fixture for products
mongoose-fixture --generateFixture='Products'

# output in cli showing the path used
Generating DataFixture -&gt; /your_project/fixtures/Products.js

# use our cli to now create a schema
mongoose-fixture --generateSchema='ProductSchema'

# output in cli showing the path used
Generating Schema -&gt; /your_project/schemas/ProductSchema.js
</code></pre>

<p>Best place to start is to open the <code>ProductSchema.js</code> file and first define the schema for your product model.  You can view an example of the <a href="https://github.com/mgan59/mongoose-fixture-example/blob/master/schemas/ProductSchema.js">completed version</a></p>

<p>Next we should start adding our actual products to the fixture file so open the <code>fixtures/Products.js</code>.  You can view an example of the <a href="https://github.com/mgan59/mongoose-fixture-example/blob/master/fixtures/Products.js">completed version</a></p>

<h3>
<a name="running-the-fixture-import" class="anchor" href="#running-the-fixture-import"><span class="octicon octicon-link"></span></a>Running the Fixture Import</h3>

<p>Now that we have a fixture/schema we should update our config file by adding the set to our <code>FixturePackages</code> 'all'.  You can view the <a href="https://github.com/mgan59/mongoose-fixture-example/blob/master/mongoose-fixture-config.js">completed version</a></p>

<p>Finally, Time to run the fixture insert command <strong>make sure your mongodb server is running</strong></p>

<pre><code>mongoose-fixture --fixture='all' --add
</code></pre>

<p>To verify that the data was inserted connect to the mongo server and check.</p>

<pre><code>mongo --port 27017
</code></pre>

<p>Output
    MongoDB shell version: 2.2.2
    connecting to: 127.0.0.1:27017/test</p>

<pre><code>&gt; use fixture-test
switched to db fixture-test
&gt; db.products.find().pretty()
{
    "name" : "Toy Box",
    "price" : 9.99,
    "qty" : 20,
    "tags" : [
          "toys",
          "children",
          "storage"
    ],
    "__v" : 0,
    "_id" : ObjectId("5201b338bb5b194c5d000001")
}
{
    "name" : "Baseball Bat",
    "price" : 29.99,
    "qty" : 6,
    "tags" : [
          "sporting",
          "baseball",
          "outdoors"
    ],
    "__v" : 0,
    "_id" : ObjectId("5201b338bb5b194c5d000002")
}
</code></pre>

<p>You could remove the data with a similar command</p>

<pre><code>mongoose-fixture --fixture='all' --remove
</code></pre>

<p>Or if you have the use case where you need to add and remove you can do it using the --reset </p>

<pre><code>mongoose-fixture --fixture='all' --reset
</code></pre>
      </section>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-43284729-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>